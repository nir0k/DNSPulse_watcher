# Утилита Высокочастотного опроса DNS серверов

## Описание:
Эта утилита разработана для проведения высокочастотной проверки разрешений имен DNS-серверами из заранее определённого списка. Результаты этих проверок сохраняются в базу данных Prometheus с использованием функции remote write, что обеспечивает доступ к данным в реальном времени. Это предоставляет пользователям всесторонние инструменты для анализа эффективности и доступности серверной инфраструктуры, значительно повышая их способность эффективно контролировать и поддерживать целостность системы.


## Основные возможности утилиты:
- Высокочастотный опрос (по умолчанию, каждые 150 мс)
- Динамическое формирование имени для разрешения DNS серверов. (Добавляется префикс в виде unuxtime с миллисекундами)
- Проверка разрешенного адреса (проверяется что разрешен был адрес 1.1.1.1)
- Непрерывный мониторинг. (подразумевает работу 24/7)
- Возможность выбора отправляемых лейблов в конфигурации
- Синхронизация конфигурации с центрального сервера
- Логирование работы утилиты с выбором уровня логирования
- Ротация лога по заданным правилам

### Требования для запуска утилиты:
**Внимание, работы утилиты тестировалась только в операционных системах MacOS и Linux**

- файл конфигурации в формате yaml

### Пример конфигурационного файла:
```yaml
General:
  location: K2              # Пасположение сервера с утилитой
  securityZone: PROD        # Зона безопасности сервера с утилитой

ConfigHub:
    host: localhost           # IP-адрес или hostname центрального сервера
    port: 50051               # Порт для подклюяения к центральному серверу
    segment: <SegmentName>    # Название сегмента в котором расположен Watcher
    token: "<Token>"          # Токен авторизации
    encryptionKey: "<Token>"  # Ключ шифрования
    path: "data"              # Путь к директории для хранения данных конфигурации и списка опрашиваемых серверов с центрального сервера
```

### Компиляция утилиты:
```bash
make build
```
Скомпилированный пакет будет доступен в `bin/HighFrequencyDNSChecker-linux-amd64`

### Запуск:
Для запуска утилиты достаточно расположить в одной директории исполняемый файлом:
- файл config.yaml конфигурации 
- файл со списком серверов на который ссылается параметр `Resolvers->path` в конфигурации
- файл с сертификатом для web-сервера на который ссылается параметр `WebServer->sslCertPath` в конфигурации
- файл с ключем для сертификата на который ссылается параметр `WebServer->sslKeyPath` в конфигурации

Ключи запуска:
```bash
-config string
      Path to the configuration file (default "mainConf.yaml")
-logMaxAge int
      Maximum log file age (default 10)
-logMaxFiles int
      Maximum number of log files (default 10)
-logMaxSize int
      Max size for log file (Mb) (default 10)
-logPath string
      Path to the log file (default "log")
-logSeverity string
      Min log severity (default "debug")
--help 
      Show help
```
Пример запуска утилиты
```bash
chmod +x HighFrequencyDNSChecker-linux-amd64
./HighFrequencyDNSChecker-linux-amd64
```
